<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Content</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            padding: 24px;
        }

        .attack-section {
            background: rgb(255, 255, 255);
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .attack-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .attack-header:hover {
            background: #f9fafb;
        }

        .attack-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .expand-icon {
            transition: transform 0.2s;
        }

        .expand-icon.expanded {
            transform: rotate(90deg);
        }

        .attack-details {
            display: none;
            padding: 24px;
        }

        .attack-details.expanded {
            display: block;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: 4px 0 0 4px;
        }

        .metric-card.excellent::before { background: #10b981; }
        .metric-card.optimal::before { background: #10b981; }
        .metric-card.normal::before { background: #10b981; }
        .metric-card.online::before { background: #10b981; }
        .metric-card.operational::before { background: #10b981; }
        .metric-card.high::before { background: #f59e0b; }

        .metric-label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
        }

        .metric-status {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        .timeline-section {
            margin: 30px 0;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timeline-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
        }

        .timeline-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 14px;
        }

        .chart-container {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            padding: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .legend {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .time-select {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 12px;
            cursor: pointer;
            outline: none;
        }

        .time-select:hover {
            border-color: #9ca3af;
        }

        .time-select:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .control-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #374151;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .control-btn:hover {
            background: #f3f4f6;
        }

        .control-btn.paused {
            background: #fef3c7;
            color: #d97706;
            border-color: #fcd34d;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .stat-icon.warning { background: #fef3c7; color: #d97706; }
        .stat-icon.info { background: #dbeafe; color: #2563eb; }
        .stat-icon.success { background: #d1fae5; color: #16a34a; }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
        }

        .stat-change {
            font-size: 11px;
            margin-top: 4px;
        }

        .stat-change.positive { color: #16a34a; }
        .stat-change.negative { color: #dc2626; }

        .live-feed {
            margin-top: 30px;
        }

        .live-feed-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .feed-table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
        }

        .feed-table thead,
        .feed-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .feed-table th {
            background: #f9fafb;
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .feed-table td {
            padding: 12px;
            font-size: 13px;
            border-bottom: 1px solid #f3f4f6;
        }

        .feed-table tr:hover {
            background: #f9fafb;
        }

        .confidence-high {
            background: #fef2f2;
            color: #991b1b;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .action-button {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #bfdbfe;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-button:hover {
            background: #dbeafe;
        }

        .ddos-status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ddos-status-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .ddos-status-card.normal { border-color: #10b981; background: #f0fdf4; }
        .ddos-status-card.elevated { border-color: #f59e0b; background: #fffbeb; }
        .ddos-status-card.attack { border-color: #ef4444; background: #fef2f2; }

        .ddos-status-header {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .ddos-rate {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .ddos-description {
            font-size: 12px;
            color: #6b7280;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1a1d29;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #2d3139;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 1;
        }

        .modal-close:hover {
            background: #ef4444;
            color: white;
        }

        .modal-section {
            padding: 30px;
            border-bottom: 1px solid #2d3139;
        }

        .modal-section:last-child {
            border-bottom: none;
        }

        .modal-section h3 {
            color: #e5e7eb;
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .modal-label {
            color: #9ca3af;
            font-size: 12px;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-value {
            color: #e5e7eb;
            font-size: 16px;
            font-weight: 500;
        }

        .modal-description {
            color: #d1d5db;
            font-size: 14px;
            line-height: 1.6;
            background: #2d3139;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }

        .severity-badge {
            background: #7f1d1d;
            color: #fca5a5;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .severity-badge.medium {
            background: #78350f;
            color: #fcd34d;
        }

        .severity-badge.high {
            background: #92400e;
            color: #fb923c;
        }

        .status-badge {
            background: #7f1d1d;
            color: #fca5a5;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.closed {
            background: #064e3b;
            color: #6ee7b7;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-row {
                grid-template-columns: 1fr;
            }
            
            .ddos-status-cards {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
            }

            .modal-grid {
                grid-template-columns: 1fr;
            }

            .modal-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>

    <!-- DDoS Detection Dashboard Section -->
    <div class="attack-section">
        <div class="attack-header" onclick="toggleSection('ddos')">
            <div class="attack-title">DDoS Detection Dashboard</div>
            <div class="expand-icon" id="ddos-icon">▶</div>
        </div>
        <div class="attack-details" id="ddos-details">
            <!-- DDoS Service Status -->
            <div class="ddos-status-cards">
                <div class="ddos-status-card" id="ddosServiceCard">
                    <div class="ddos-status-header">LSTM DDoS Service</div>
                    <div class="ddos-rate" id="ddosServiceStatus">Loading...</div>
                    <div class="ddos-description" id="ddosServiceDescription">Initializing DDoS detection service</div>
                </div>
                <div class="ddos-status-card" id="modelStatusCard">
                    <div class="ddos-status-header">Model Status</div>
                    <div class="ddos-rate" id="modelStatusValue">Unknown</div>
                    <div class="ddos-description" id="modelStatusDescription">Checking model availability</div>
                </div>
                <div class="ddos-status-card" id="detectionStatsCard">
                    <div class="ddos-status-header">Detection Statistics</div>
                    <div class="ddos-rate" id="detectionStatsValue">0</div>
                    <div class="ddos-description" id="detectionStatsDescription">Total detections processed</div>
                </div>
            </div>

            <!-- Real-time Attack Probability Chart -->
            <div class="timeline-section">
                <div class="timeline-header">
                    <div class="timeline-title">Attack Probability Over Time</div>
                    <div class="timeline-controls">
                        <button class="control-btn" id="ddosPauseBtn" onclick="toggleDDoSUpdates()">
                            <span id="ddosPauseIcon">⏸</span>
                            <span id="ddosPauseText">Pause</span>
                        </button>
                        <span>Auto refresh: <span id="ddosRefreshRate">5s</span></span>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ef4444;"></div>
                                <span>Attack Probability</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #f59e0b; border-style: dashed;"></div>
                                <span>Threshold (0.5)</span>
                            </div>
                        </div>
                    </div>
                    <canvas class="chart-canvas" id="ddosAttackChart"></canvas>
                </div>
            </div>

            <!-- DDoS Alerts Table -->
            <div class="live-feed">
                <div class="live-feed-header">
                    <div class="live-indicator"></div>
                    <span style="font-weight: 600;">Recent DDoS Alerts</span>
                </div>
                <table class="feed-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Source IP</th>
                            <th>Probability</th>
                            <th>Intensity</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="ddosAlertsTable">
                        <tr>
                            <td colspan="5" style="padding: 24px; text-align: center; color: #6b7280;">No DDoS alerts detected</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Injection Detection Dashboard Section -->
    <div class="attack-section">
        <div class="attack-header" onclick="toggleSection('injection')">
            <div class="attack-title">Injection Detection Dashboard</div>
            <div class="expand-icon" id="injection-icon">▶</div>
        </div>
        <div class="attack-details" id="injection-details">
            <!-- Injection Service Status -->
            <div class="ddos-status-cards">
                <div class="ddos-status-card" id="injectionServiceCard">
                    <div class="ddos-status-header">Injection Detection Service</div>
                    <div class="ddos-rate" id="injectionServiceStatus">Loading...</div>
                    <div class="ddos-description" id="injectionServiceDescription">Initializing injection detection service</div>
                </div>
                <div class="ddos-status-card" id="injectionModelCard">
                    <div class="ddos-status-header">Detection Engine</div>
                    <div class="ddos-rate" id="injectionModelValue">Unknown</div>
                    <div class="ddos-description" id="injectionModelDescription">Checking detection engine availability</div>
                </div>
                <div class="ddos-status-card" id="injectionStatsCard">
                    <div class="ddos-status-header">Detection Statistics</div>
                    <div class="ddos-rate" id="injectionStatsValue">0</div>
                    <div class="ddos-description" id="injectionStatsDescription">Total injection attempts detected</div>
                </div>
            </div>

            <!-- Real-time Injection Detection Chart -->
            <div class="timeline-section">
                <div class="timeline-header">
                    <div class="timeline-title">Injection Attempts Over Time</div>
                    <div class="timeline-controls">
                        <button class="control-btn" id="injectionPauseBtn" onclick="toggleInjectionUpdates()">
                            <span id="injectionPauseIcon">⏸</span>
                            <span id="injectionPauseText">Pause</span>
                        </button>
                        <span>Auto refresh: <span id="injectionRefreshRate">5s</span></span>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #dc2626;"></div>
                                <span>SQL Injection</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ea580c;"></div>
                                <span>XSS</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #d97706;"></div>
                                <span>Command Injection</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #65a30d;"></div>
                                <span>Normal Traffic</span>
                            </div>
                        </div>
                    </div>
                    <canvas class="chart-canvas" id="injectionChart"></canvas>
                </div>
            </div>

            <!-- Injection Alerts Table -->
            <div class="live-feed">
                <div class="live-feed-header">
                    <div class="live-indicator"></div>
                    <span style="font-weight: 600;">Recent Injection Alerts</span>
                </div>
                <table class="feed-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Source IP</th>
                            <th>Attack Type</th>
                            <th>Confidence</th>
                            <th>Target</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="injectionAlertsTable">
                        <tr>
                            <td colspan="6" style="padding: 24px; text-align: center; color: #6b7280;">No injection alerts detected</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- System Health Section -->
    <div class="attack-section">
        <div class="attack-header">
            <div class="attack-title"> System Health</div>
        </div>
        <div class="attack-details expanded">
            <div class="metrics-grid">
                <div class="metric-card excellent">
                    <div class="metric-label">Detection Accuracy</div>
                    <div class="metric-value">96.8%</div>
                    <div class="metric-status">Excellent</div>
                </div>
                <div class="metric-card optimal">
                    <div class="metric-label">Response Time</div>
                    <div class="metric-value">1.2s</div>
                    <div class="metric-status">Optimal</div>
                </div>
                <div class="metric-card high">
                    <div class="metric-label">CPU Usage</div>
                    <div class="metric-value">78%</div>
                    <div class="metric-status">High</div>
                </div>
                <div class="metric-card normal">
                    <div class="metric-label">Memory Usage</div>
                    <div class="metric-value">62%</div>
                    <div class="metric-status">Normal</div>
                </div>
                <div class="metric-card online">
                    <div class="metric-label">Database</div>
                    <div class="metric-value">99.9%</div>
                    <div class="metric-status">Online</div>
                </div>
                <div class="metric-card operational">
                    <div class="metric-label">API Services</div>
                    <div class="metric-value">100%</div>
                    <div class="metric-status">Operational</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attack Details Modal -->
    <div class="modal-overlay" id="attackModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAttackModal()">✕</button>
            
            <div class="modal-section">
                <h3>ℹ️ Incident Overview</h3>
                <div class="modal-grid">
                    <div>
                        <div class="modal-label">Incident ID</div>
                        <div class="modal-value" id="modal-incident-id">INC-2847</div>
                    </div>
                    <div>
                        <div class="modal-label">Severity</div>
                        <div class="modal-value">
                            <span class="severity-badge" id="modal-severity">CRITICAL</span>
                        </div>
                    </div>
                    <div>
                        <div class="modal-label">Status</div>
                        <div class="modal-value">
                            <span class="status-badge" id="modal-status">OPEN</span>
                        </div>
                    </div>
                </div>
                <div class="modal-grid" style="margin-top: 20px;">
                    <div>
                        <div class="modal-label">Assigned To</div>
                        <div class="modal-value" id="modal-assigned">Unassigned</div>
                    </div>
                    <div>
                        <div class="modal-label">Created</div>
                        <div class="modal-value" id="modal-created">2025-01-15 14:30:22</div>
                    </div>
                    <div>
                        <div class="modal-label">Last Updated</div>
                        <div class="modal-value" id="modal-updated">2025-01-15 14:30:22</div>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h3>🎯 Attack Details</h3>
                <div class="modal-grid">
                    <div>
                        <div class="modal-label">Attack Type</div>
                        <div class="modal-value" id="modal-attack-type">SQL Injection</div>
                    </div>
                    <div>
                        <div class="modal-label">Source IP</div>
                        <div class="modal-value" id="modal-source-ip">192.168.1.45</div>
                    </div>
                    <div>
                        <div class="modal-label">Target</div>
                        <div class="modal-value" id="modal-target">web-server-01</div>
                    </div>
                </div>
                                <div style="margin-top: 15px;">
                    <div class="modal-label">Confidence Score</div>
                    <div class="modal-value" id="modal-confidence">95.0%</div>
                </div>
                <div style="margin-top: 15px;">
                    <div class="modal-label">Description</div>
                    <div class="modal-description" id="modal-description">
                        High-volume attack detected targeting web server infrastructure
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let trafficChart = null;
        let updateInterval = null;
        let isPaused = false;
        let timeRange = 30;
        let trafficData = [];


        // DDoS Dashboard variables
        let ddosChart = null;
        let ddosUpdateInterval = null;
        let ddosIsPaused = false;
        let ddosData = [];
        let ddosAlerts = [];

        function toggleSection(sectionId) {
            const details = document.getElementById(sectionId + '-details');
            const icon = document.getElementById(sectionId + '-icon');
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.textContent = '▶';
            } else {
                details.classList.add('expanded');
                icon.classList.add('expanded');
                icon.textContent = '▼';
                
                if (sectionId === 'ddos' && !ddosChart) {
                    setTimeout(() => {
                        initializeDDoSChart();
                        loadDDoSStatus();
                        loadDDoSAlerts();
                        startDDoSUpdates();
                    }, 100);
                }
                
                if (sectionId === 'injection' && !injectionChart) {
                    setTimeout(() => {
                        initializeInjectionChart();
                        loadInjectionStatus();
                        loadInjectionAlerts();
                        startInjectionUpdates();
                    }, 100);
                }
            }
        }

        function initializeTrafficChart() {
            const canvas = document.getElementById('trafficChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * window.devicePixelRatio;
            canvas.height = canvas.offsetHeight * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            trafficChart = {
                canvas: canvas,
                ctx: ctx,
                width: canvas.offsetWidth,
                height: canvas.offsetHeight
            };
        }

        function generateInitialData() {
            const now = new Date();
            trafficData = [];
            
            let dataPoints, intervalMinutes;
            if (timeRange <= 60) {
                dataPoints = timeRange;
                intervalMinutes = 1;
            } else if (timeRange <= 180) {
                dataPoints = 60;
                intervalMinutes = 3;
            } else {
                dataPoints = 48;
                intervalMinutes = 30;
            }
            
            for (let i = dataPoints - 1; i >= 0; i--) {
                const time = new Date(now.getTime() - i * intervalMinutes * 60000);
                let incoming, blocked;
                const attackPoint = Math.floor(dataPoints * 0.4);
                
                if (i > attackPoint) {
                    incoming = Math.random() * 800 + 200;
                    blocked = Math.random() * 100 + 50;
                } else if (i > attackPoint * 0.3) {
                    const intensity = (attackPoint - i) / (attackPoint * 0.7);
                    incoming = Math.random() * 6000 * intensity + 1000;
                    blocked = incoming * 0.8 + Math.random() * 500;
                } else {
                    incoming = Math.random() * 3000 + 7000;
                    blocked = incoming * 0.85 + Math.random() * 800;
                }
                
                trafficData.push({
                    time: time,
                    incoming: Math.round(incoming),
                    blocked: Math.round(blocked),
                    intervalMinutes: intervalMinutes
                });
            }
            
            drawTrafficChart();
        }

        function drawTrafficChart() {
            if (!trafficChart) return;
            
            const ctx = trafficChart.ctx;
            const width = trafficChart.width;
            const height = trafficChart.height;
            const padding = 50;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const maxValue = 10000;
            
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            drawGrid(ctx, padding, chartWidth, chartHeight, maxValue);
            drawThresholds(ctx, padding, chartWidth, chartHeight, maxValue);
            drawTrafficLines(ctx, padding, chartWidth, chartHeight, maxValue);
            drawTimeLabels(ctx, padding, chartWidth, chartHeight);
        }

        function drawGrid(ctx, padding, chartWidth, chartHeight, maxValue) {
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.fillStyle = '#6b7280';
            ctx.font = '11px Arial';
            
            for (let i = 0; i <= 10; i++) {
                const y = padding + (chartHeight / 10) * i;
                const value = Math.round(maxValue - (maxValue / 10) * i);
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
                
                ctx.textAlign = 'right';
                ctx.fillText(value.toLocaleString(), padding - 10, y + 4);
            }
            
            const dataPoints = trafficData.length;
            for (let i = 0; i < dataPoints; i += 5) {
                const x = padding + (chartWidth / (dataPoints - 1)) * i;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
            }
        }

        function drawThresholds(ctx, padding, chartWidth, chartHeight, maxValue) {
            const normalY = padding + chartHeight - (1000 / maxValue) * chartHeight;
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, normalY);
            ctx.lineTo(padding + chartWidth, normalY);
            ctx.stroke();
            
            const warningY = padding + chartHeight - (5000 / maxValue) * chartHeight;
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, warningY);
            ctx.lineTo(padding + chartWidth, warningY);
            ctx.stroke();
            
            ctx.setLineDash([]);
        }

        function drawTrafficLines(ctx, padding, chartWidth, chartHeight, maxValue) {
            if (trafficData.length < 2) return;
            
            const dataPoints = trafficData.length;
            
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            trafficData.forEach((point, index) => {
                const x = padding + (chartWidth / (dataPoints - 1)) * index;
                const y = padding + chartHeight - (point.incoming / maxValue) * chartHeight;
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            trafficData.forEach((point, index) => {
                const x = padding + (chartWidth / (dataPoints - 1)) * index;
                const y = padding + chartHeight - (point.blocked / maxValue) * chartHeight;
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        function drawTimeLabels(ctx, padding, chartWidth, chartHeight) {
            ctx.fillStyle = '#6b7280';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            
            const dataPoints = trafficData.length;
            const labelInterval = Math.max(1, Math.floor(dataPoints / 6));
            
            for (let i = 0; i < dataPoints; i += labelInterval) {
                const x = padding + (chartWidth / (dataPoints - 1)) * i;
                const time = trafficData[i].time;
                
                let timeStr;
                if (timeRange <= 180) {
                    timeStr = time.getHours().toString().padStart(2, '0') + ':' + 
                             time.getMinutes().toString().padStart(2, '0');
                } else {
                    timeStr = (time.getMonth() + 1).toString().padStart(2, '0') + '/' +
                             time.getDate().toString().padStart(2, '0') + ' ' +
                             time.getHours().toString().padStart(2, '0') + ':' +
                             time.getMinutes().toString().padStart(2, '0');
                }
                
                ctx.fillText(timeStr, x, padding + chartHeight + 15);
            }
        }

        function startRealTimeUpdates() {
            updateInterval = setInterval(() => {
                if (!isPaused) {
                    addNewDataPoint();
                    drawTrafficChart();
                }
            }, 2000);
        }

        function addNewDataPoint() {
            const now = new Date();
            const lastPoint = trafficData[trafficData.length - 1];
            
            let incoming = lastPoint.incoming + (Math.random() - 0.5) * 1000;
            incoming = Math.max(0, incoming);
            
            let blocked = incoming * 0.8 + Math.random() * 300;
            blocked = Math.min(blocked, incoming);
            blocked = Math.max(0, blocked);
            
            trafficData.push({
                time: now,
                incoming: Math.round(incoming),
                blocked: Math.round(blocked),
                intervalMinutes: trafficData[0].intervalMinutes
            });
            
            let maxPoints = timeRange <= 60 ? timeRange : (timeRange <= 180 ? 60 : 48);
            if (trafficData.length > maxPoints) trafficData.shift();
        }

        function setTimeRange() {
            timeRange = parseInt(document.getElementById('timeRangeSelect').value);
            generateInitialData();
        }

        function toggleUpdates() {
            const pauseBtn = document.getElementById('pauseBtn');
            const pauseIcon = document.getElementById('pauseIcon');
            const pauseText = document.getElementById('pauseText');
            
            isPaused = !isPaused;
            
            if (isPaused) {
                pauseBtn.classList.add('paused');
                pauseIcon.textContent = '▶';
                pauseText.textContent = 'Resume';
            } else {
                pauseBtn.classList.remove('paused');
                pauseIcon.textContent = '⏸';
                pauseText.textContent = 'Pause';
            }
        }

        function initializeInjectionChart() {
            const canvas = document.getElementById('injectionChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * window.devicePixelRatio;
            canvas.height = canvas.offsetHeight * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            injectionChart = {
                canvas: canvas,
                ctx: ctx,
                width: canvas.offsetWidth,
                height: canvas.offsetHeight
            };
        }

        function generateInjectionData() {
            const timeRange = parseInt(document.getElementById('injectionTimeRangeSelect').value);
            injectionData = [];
            
            let data = [];
            
            if (timeRange === 7) {
                data = [
                    { label: 'Mon', sql: 1200, xss: 800, command: 450 },
                    { label: 'Tue', sql: 1500, xss: 950, command: 520 },
                    { label: 'Wed', sql: 1100, xss: 700, command: 380 },
                    { label: 'Thu', sql: 1800, xss: 1100, command: 600 },
                    { label: 'Fri', sql: 2000, xss: 1300, command: 720 },
                    { label: 'Sat', sql: 900, xss: 600, command: 300 },
                    { label: 'Sun', sql: 850, xss: 550, command: 280 }
                ];
            } else if (timeRange === 30) {
                data = [
                    { label: 'Week 1', sql: 8500, xss: 5200, command: 2800 },
                    { label: 'Week 2', sql: 9200, xss: 6100, command: 3200 },
                    { label: 'Week 3', sql: 7800, xss: 4900, command: 2600 },
                    { label: 'Week 4', sql: 10500, xss: 6800, command: 3500 }
                ];
            } else {
                data = [
                    { label: 'Jan', sql: 32000, xss: 20000, command: 6000 },
                    { label: 'Feb', sql: 25000, xss: 15000, command: 5000 },
                    { label: 'Mar', sql: 24000, xss: 13000, command: 7000 },
                    { label: 'Apr', sql: 43000, xss: 12000, command: 10000 },
                    { label: 'May', sql: 17000, xss: 43000, command: 5000 },
                    { label: 'Jun', sql: 12000, xss: 25000, command: 45000 },
                    { label: 'Jul', sql: 23000, xss: 41000, command: 8000 },
                    { label: 'Aug', sql: 43000, xss: 27000, command: 7000 },
                    { label: 'Sep', sql: 28000, xss: 35000, command: 6000 },
                    { label: 'Oct', sql: 50000, xss: 12000, command: 10000 },
                    { label: 'Nov', sql: 22000, xss: 16000, command: 33000 },
                    { label: 'Dec', sql: 47000, xss: 9000, command: 8000 }
                ];
            }
            
            injectionData = data;
            drawInjectionChart();
        }

        function drawInjectionChart() {
            if (!injectionChart) return;
            
            const ctx = injectionChart.ctx;
            const width = injectionChart.width;
            const height = injectionChart.height;
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const maxValue = 50000;
            
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 10; i++) {
                const y = padding + (chartHeight / 10) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
            }
            
            ctx.fillStyle = '#6b7280';
            ctx.font = '11px Arial';
            ctx.textAlign = 'right';
            
            for (let i = 0; i <= 10; i++) {
                const y = padding + (chartHeight / 10) * i;
                const value = maxValue - (maxValue / 10) * i;
                ctx.fillText(value.toLocaleString(), padding - 10, y + 4);
            }
            
            ctx.textAlign = 'center';
            const pointSpacing = chartWidth / (injectionData.length - 1);
            
            injectionData.forEach((point, index) => {
                const x = padding + pointSpacing * index;
                ctx.fillText(point.label, x, padding + chartHeight + 20);
                
                ctx.strokeStyle = '#e5e7eb';
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
            });
            
            ctx.strokeStyle = '#ef4444';
            ctx.fillStyle = '#ef4444';
            ctx.lineWidth = 2;
            
            injectionData.forEach((point, index) => {
                const x = padding + pointSpacing * index;
                const y = padding + chartHeight - (point.sql / maxValue) * chartHeight;
                
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(x, padding + chartHeight);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.strokeStyle = '#f59e0b';
            ctx.fillStyle = '#f59e0b';
            
            injectionData.forEach((point, index) => {
                const x = padding + pointSpacing * index;
                const y = padding + chartHeight - (point.xss / maxValue) * chartHeight;
                
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(x, padding + chartHeight);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.strokeStyle = '#8b5cf6';
            ctx.fillStyle = '#8b5cf6';
            
            injectionData.forEach((point, index) => {
                const x = padding + pointSpacing * index;
                const y = padding + chartHeight - (point.command / maxValue) * chartHeight;
                
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(x, padding + chartHeight);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 2;
            ctx.setLineDash([]);
            
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + chartHeight);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(padding, padding + chartHeight);
            ctx.lineTo(padding + chartWidth, padding + chartHeight);
            ctx.stroke();
        }

        function setInjectionTimeRange() {
            generateInjectionData();
        }

        function toggleInjectionUpdates() {
            const pauseBtn = document.getElementById('injectionPauseBtn');
            const pauseIcon = document.getElementById('injectionPauseIcon');
            const pauseText = document.getElementById('injectionPauseText');
            
            injectionIsPaused = !injectionIsPaused;
            
            if (injectionIsPaused) {
                pauseBtn.classList.add('paused');
                pauseIcon.textContent = '▶';
                pauseText.textContent = 'Resume';
            } else {
                pauseBtn.classList.remove('paused');
                pauseIcon.textContent = '⏸';
                pauseText.textContent = 'Pause';
            }
        }

        function startInjectionUpdates() {
            // Placeholder for future real-time updates
        }

        function showAttackDetails(button) {
            const row = button.closest('tr');
            const cells = row.getElementsByTagName('td');
            
            const sourceIP = cells[0].textContent.trim();
            const timestamp = cells[1].textContent.trim();
            const attackType = cells[2].textContent.trim();
            const confidence = cells[3].textContent.trim();
            const target = cells[4].textContent.trim();
            
            const incidentId = 'INC-' + Math.floor(Math.random() * 9000 + 1000);
            
            document.getElementById('modal-incident-id').textContent = incidentId;
            document.getElementById('modal-source-ip').textContent = sourceIP;
            document.getElementById('modal-created').textContent = timestamp;
            document.getElementById('modal-updated').textContent = timestamp;
            document.getElementById('modal-attack-type').textContent = attackType;
            document.getElementById('modal-confidence').textContent = confidence;
            document.getElementById('modal-target').textContent = target;
            
            const severityBadge = document.getElementById('modal-severity');
            if (attackType.includes('SQL')) {
                severityBadge.textContent = 'CRITICAL';
                severityBadge.className = 'severity-badge';
            } else if (attackType.includes('Command')) {
                severityBadge.textContent = 'HIGH';
                severityBadge.className = 'severity-badge high';
            } else {
                severityBadge.textContent = 'MEDIUM';
                severityBadge.className = 'severity-badge medium';
            }
            
            const descriptions = {
                'SQL Injection': 'Malicious SQL code injection attempt detected. The attacker is trying to manipulate database queries to gain unauthorized access to sensitive data.',
                'XSS Attack': 'Cross-Site Scripting attack detected. Malicious scripts are being injected into web pages viewed by other users.',
                'Command Injection': 'OS command injection attack detected. The attacker is attempting to execute arbitrary commands on the host operating system.'
            };
            
            document.getElementById('modal-description').textContent = 
                descriptions[attackType] || 'Security threat detected targeting system infrastructure.';
            
            const modal = document.getElementById('attackModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeAttackModal() {
            const modal = document.getElementById('attackModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('attackModal');
            if (event.target === modal) {
                closeAttackModal();
            }
        });
        
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAttackModal();
            }
        });

        // DDoS Dashboard Functions
        function initializeDDoSChart() {
            const canvas = document.getElementById('ddosAttackChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * window.devicePixelRatio;
            canvas.height = canvas.offsetHeight * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            ddosChart = {
                canvas: canvas,
                ctx: ctx,
                width: canvas.offsetWidth,
                height: canvas.offsetHeight,
                data: [],
                maxPoints: 50
            };
        }

        async function loadDDoSStatus() {
            try {
                const response = await fetch('http://localhost:5000/ddos/lstm/status');
                const data = await response.json();
                
                if (response.ok && data.available) {
                    updateDDoSStatusCards(data.statistics);
                } else {
                    updateDDoSStatusCards(null);
                }
            } catch (error) {
                console.error('Failed to load DDoS status:', error);
                updateDDoSStatusCards(null);
            }
        }

        function updateDDoSStatusCards(stats) {
            const serviceCard = document.getElementById('ddosServiceCard');
            const modelCard = document.getElementById('modelStatusCard');
            const statsCard = document.getElementById('detectionStatsCard');

            if (stats) {
                // Service Status
                serviceCard.className = 'ddos-status-card normal';
                document.getElementById('ddosServiceStatus').textContent = 'Running';
                document.getElementById('ddosServiceDescription').textContent = 'LSTM DDoS service is active';

                // Model Status
                const modelLoaded = stats.model_loaded ? 'Loaded' : 'Not Loaded';
                modelCard.className = stats.model_loaded ? 'ddos-status-card normal' : 'ddos-status-card elevated';
                document.getElementById('modelStatusValue').textContent = modelLoaded;
                document.getElementById('modelStatusDescription').textContent = `Device: ${stats.device || 'unknown'}`;

                // Detection Statistics
                statsCard.className = 'ddos-status-card normal';
                document.getElementById('detectionStatsValue').textContent = stats.total_detections || 0;
                document.getElementById('detectionStatsDescription').textContent = `Attack detections: ${stats.attack_detections || 0}`;
            } else {
                // Service unavailable
                serviceCard.className = 'ddos-status-card attack';
                document.getElementById('ddosServiceStatus').textContent = 'Stopped';
                document.getElementById('ddosServiceDescription').textContent = 'DDoS service unavailable';

                modelCard.className = 'ddos-status-card attack';
                document.getElementById('modelStatusValue').textContent = 'Unknown';
                document.getElementById('modelStatusDescription').textContent = 'Service not available';

                statsCard.className = 'ddos-status-card attack';
                document.getElementById('detectionStatsValue').textContent = '0';
                document.getElementById('detectionStatsDescription').textContent = 'No data available';
            }
        }

        async function loadDDoSAlerts() {
            try {
                const response = await fetch('http://localhost:5000/ddos/lstm/alerts');
                const data = await response.json();
                
                if (response.ok && data.alerts) {
                    ddosAlerts = data.alerts;
                    updateDDoSAlertsTable();
                }
            } catch (error) {
                console.error('Failed to load DDoS alerts:', error);
            }
        }

        function updateDDoSAlertsTable() {
            const tbody = document.getElementById('ddosAlertsTable');
            if (!tbody) return;
            
            if (ddosAlerts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="padding: 24px; text-align: center; color: #6b7280;">No DDoS alerts detected</td></tr>';
                return;
            }
            
            tbody.innerHTML = ddosAlerts.map(alert => {
                const timestamp = new Date(alert.timestamp * 1000).toLocaleString();
                const probability = (alert.attack_probability * 100).toFixed(1);
                const intensity = (alert.attack_intensity * 100).toFixed(1);
                const status = alert.attack_probability > 0.5 ? 
                    '<span class="confidence-high">ATTACK</span>' : 
                    '<span style="color: #10b981; font-weight: 600;">NORMAL</span>';
                
                return `
                    <tr>
                        <td>${timestamp}</td>
                        <td style="font-family: monospace;">${alert.source_ip}</td>
                        <td>${probability}%</td>
                        <td>${intensity}%</td>
                        <td>${status}</td>
                    </tr>
                `;
            }).join('');
        }

        function startDDoSUpdates() {
            ddosUpdateInterval = setInterval(async () => {
                if (!ddosIsPaused) {
                    await loadDDoSStatus();
                    await loadDDoSAlerts();
                    
                    // Add random data point for chart
                    if (ddosChart && Math.random() < 0.3) {
                        const probability = Math.random() * 0.3;
                        addDDoSDataPoint(probability);
                    }
                }
            }, 5000);
        }

        function addDDoSDataPoint(value) {
            if (!ddosChart) return;
            
            ddosChart.data.push({ value: value, timestamp: Date.now() });
            if (ddosChart.data.length > ddosChart.maxPoints) {
                ddosChart.data.shift();
            }
            drawDDoSChart();
        }

        function drawDDoSChart() {
            if (!ddosChart) return;
            
            const ctx = ddosChart.ctx;
            const width = ddosChart.width;
            const height = ddosChart.height;
            const padding = 50;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            if (ddosChart.data.length < 2) {
                ctx.fillStyle = '#6b7280';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', width / 2, height / 2);
                return;
            }
            
            // Draw axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw threshold line
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            const thresholdY = height - padding - (0.5 * chartHeight);
            ctx.moveTo(padding, thresholdY);
            ctx.lineTo(width - padding, thresholdY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw data line
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const dataPoints = ddosChart.data.length;
            for (let i = 0; i < dataPoints; i++) {
                const x = padding + (i / (dataPoints - 1)) * chartWidth;
                const y = height - padding - (ddosChart.data[i].value * chartHeight);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Draw labels
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('0', padding - 20, height - padding + 4);
            ctx.fillText('0.5', padding - 20, thresholdY + 4);
            ctx.fillText('1.0', padding - 20, padding + 4);
        }

        function toggleDDoSUpdates() {
            const pauseBtn = document.getElementById('ddosPauseBtn');
            const pauseIcon = document.getElementById('ddosPauseIcon');
            const pauseText = document.getElementById('ddosPauseText');
            
            ddosIsPaused = !ddosIsPaused;
            
            if (ddosIsPaused) {
                pauseBtn.classList.add('paused');
                pauseIcon.textContent = '▶';
                pauseText.textContent = 'Resume';
            } else {
                pauseBtn.classList.remove('paused');
                pauseIcon.textContent = '⏸';
                pauseText.textContent = 'Pause';
            }
        }

        // Injection Dashboard variables
        let injectionChart = null;
        let injectionUpdateInterval = null;
        let injectionIsPaused = false;
        let injectionData = [];
        let injectionAlerts = [];

        // Injection Dashboard Functions
        function initializeInjectionChart() {
            const canvas = document.getElementById('injectionChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth * window.devicePixelRatio;
            canvas.height = canvas.offsetHeight * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            
            injectionChart = {
                canvas: canvas,
                ctx: ctx,
                width: canvas.offsetWidth,
                height: canvas.offsetHeight,
                data: [],
                maxPoints: 50
            };
        }

        async function loadInjectionStatus() {
            try {
                const response = await fetch('http://localhost:5000/monitor/stats');
                const data = await response.json();
                
                if (response.ok) {
                    updateInjectionStatusCards(data);
                } else {
                    updateInjectionStatusCards(null);
                }
            } catch (error) {
                console.error('Failed to load injection status:', error);
                updateInjectionStatusCards(null);
            }
        }

        function updateInjectionStatusCards(stats) {
            const serviceCard = document.getElementById('injectionServiceCard');
            const modelCard = document.getElementById('injectionModelCard');
            const statsCard = document.getElementById('injectionStatsCard');

            if (stats) {
                // Service Status
                serviceCard.className = 'ddos-status-card normal';
                document.getElementById('injectionServiceStatus').textContent = 'Running';
                document.getElementById('injectionServiceDescription').textContent = 'Injection detection service is active';

                // Model Status
                const detectorAvailable = stats.detector_available ? 'Available' : 'Not Available';
                modelCard.className = stats.detector_available ? 'ddos-status-card normal' : 'ddos-status-card elevated';
                document.getElementById('injectionModelValue').textContent = detectorAvailable;
                document.getElementById('injectionModelDescription').textContent = `Threshold: ${stats.detection_threshold || 0.5}`;

                // Detection Statistics
                statsCard.className = 'ddos-status-card normal';
                document.getElementById('injectionStatsValue').textContent = stats.injection_attempts_detected || 0;
                document.getElementById('injectionStatsDescription').textContent = `Total requests: ${stats.total_requests_monitored || 0}`;
            } else {
                // Service unavailable
                serviceCard.className = 'ddos-status-card attack';
                document.getElementById('injectionServiceStatus').textContent = 'Stopped';
                document.getElementById('injectionServiceDescription').textContent = 'Injection service unavailable';

                modelCard.className = 'ddos-status-card attack';
                document.getElementById('injectionModelValue').textContent = 'Unknown';
                document.getElementById('injectionModelDescription').textContent = 'Service not available';

                statsCard.className = 'ddos-status-card attack';
                document.getElementById('injectionStatsValue').textContent = '0';
                document.getElementById('injectionStatsDescription').textContent = 'No data available';
            }
        }

        async function loadInjectionAlerts() {
            try {
                const response = await fetch('http://localhost:5000/monitor/alerts');
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    injectionAlerts = data;
                    updateInjectionAlertsTable();
                }
            } catch (error) {
                console.error('Failed to load injection alerts:', error);
            }
        }

        function updateInjectionAlertsTable() {
            const tbody = document.getElementById('injectionAlertsTable');
            if (!tbody) return;
            
            if (injectionAlerts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding: 24px; text-align: center; color: #6b7280;">No injection alerts detected</td></tr>';
                return;
            }
            
            tbody.innerHTML = injectionAlerts.map(alert => {
                const timestamp = new Date(alert.timestamp).toLocaleString();
                const confidence = (alert.confidence * 100).toFixed(1);
                const attackType = alert.attack_type || 'Unknown';
                const status = alert.confidence > 0.5 ? 
                    '<span class="confidence-high">ATTACK</span>' : 
                    '<span style="color: #10b981; font-weight: 600;">NORMAL</span>';
                
                return `
                    <tr>
                        <td>${timestamp}</td>
                        <td style="font-family: monospace;">${alert.source_ip || 'Unknown'}</td>
                        <td>${attackType}</td>
                        <td>${confidence}%</td>
                        <td>${alert.endpoint || 'Unknown'}</td>
                        <td>${status}</td>
                    </tr>
                `;
            }).join('');
        }

        function startInjectionUpdates() {
            injectionUpdateInterval = setInterval(async () => {
                if (!injectionIsPaused) {
                    await loadInjectionStatus();
                    await loadInjectionAlerts();
                    
                    // Add random data point for chart
                    if (injectionChart && Math.random() < 0.2) {
                        const attackTypes = ['sql', 'xss', 'command', 'normal'];
                        const attackType = attackTypes[Math.floor(Math.random() * attackTypes.length)];
                        addInjectionDataPoint(attackType);
                    }
                }
            }, 5000);
        }

        function addInjectionDataPoint(attackType) {
            if (!injectionChart) return;
            
            injectionChart.data.push({ 
                type: attackType, 
                timestamp: Date.now(),
                value: Math.random() * 0.8 + 0.1
            });
            if (injectionChart.data.length > injectionChart.maxPoints) {
                injectionChart.data.shift();
            }
            drawInjectionChart();
        }

        function drawInjectionChart() {
            if (!injectionChart) return;
            
            const ctx = injectionChart.ctx;
            const width = injectionChart.width;
            const height = injectionChart.height;
            const padding = 50;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            if (injectionChart.data.length < 2) {
                ctx.fillStyle = '#6b7280';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', width / 2, height / 2);
                return;
            }
            
            // Draw axes
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw data points
            const colors = {
                'sql': '#dc2626',
                'xss': '#ea580c',
                'command': '#d97706',
                'normal': '#65a30d'
            };
            
            const dataPoints = injectionChart.data.length;
            for (let i = 0; i < dataPoints; i++) {
                const point = injectionChart.data[i];
                const x = padding + (i / (dataPoints - 1)) * chartWidth;
                const y = height - padding - (point.value * chartHeight);
                
                ctx.fillStyle = colors[point.type] || '#6b7280';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            // Draw labels
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('0', padding - 20, height - padding + 4);
            ctx.fillText('0.5', padding - 20, height - padding - chartHeight/2 + 4);
            ctx.fillText('1.0', padding - 20, padding + 4);
        }

        function toggleInjectionUpdates() {
            const pauseBtn = document.getElementById('injectionPauseBtn');
            const pauseIcon = document.getElementById('injectionPauseIcon');
            const pauseText = document.getElementById('injectionPauseText');
            
            injectionIsPaused = !injectionIsPaused;
            
            if (injectionIsPaused) {
                pauseBtn.classList.add('paused');
                pauseIcon.textContent = '▶';
                pauseText.textContent = 'Resume';
            } else {
                pauseBtn.classList.remove('paused');
                pauseIcon.textContent = '⏸';
                pauseText.textContent = 'Pause';
            }
        }

        window.addEventListener('resize', function() {
            if (trafficChart) {
                initializeTrafficChart();
                drawTrafficChart();
            }
            if (injectionChart) {
                initializeInjectionChart();
                drawInjectionChart();
            }
            if (ddosChart) {
                initializeDDoSChart();
                drawDDoSChart();
            }
        });
    </script>
</body>
</html>


